<!doctype html>
<html>
    <head>
        <title>BalaclavaBunker Server Documentation</title>
        <meta charset='utf-8'/>
        <link rel="stylesheet" type="text/css" href="./balaclavabunker.html_files/styles.css">
        <script>
            window.onload = function() {
                if (document.querySelector("script[type=\"math/tex; mode=display\"]") !== null) {
                    var mathjax = document.createElement("script");
                    mathjax.src = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML";
                    document.head.appendChild(mathjax);
                }
                if (document.getElementsByTagName("code").length !== 0) {
                    var highlight = document.createElement("script");
                    var highlightcss = document.createElement("link");
                    highlight.src = "http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/highlight.min.js";
                    highlightcss.rel = "stylesheet";
                    highlightcss.href = "http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/styles/default.min.css";
                    highlight.onload = function() {hljs.initHighlighting();};
                    document.head.appendChild(highlight);
                    document.head.appendChild(highlightcss);
                }
            }
        </script>
    </head>
    <body>
        <article>
            <h1 id="balaclavabunker-server-documentation">BalaclavaBunker Server Documentation</h1>
<hr>
<h3 id="table-of-contents">Table of Contents</h3>
<h4 id="-1-services-services"><a href="#services">1. Services</a></h4>
<ul>
<li><a href="#automation">Automation/Bots</a></li><li><a href="#games">Games</a></li><li><a href="#web">Web</a></li><li><a href="#files">File Sharing / Cloud storage</a></li></ul>
<h4 id="-2-update-procedures-updates"><a href="#updates">2. Update Procedures</a></h4>
<ul>
<li><a href="#botUpdate">BlaclavaBot</a></li><li><a href="#minecraftUpdate">Minecraft</a></li><li><a href="#nextcloudUpdate">NextCloud</a></li></ul>
<hr>
<p><a id="services"></a></p>
<h2 id="services">Services</h2>
<p><a id="automation"></a></p>
<h3 id="automation-bots">Automation / Bots</h3>
<hr>
<p><a id="balaclavabot"></a></p>
<h4 id="balaclavabot-discord-bot">BalaclavaBot (Discord bot)</h4>
<p>Balaclavabot runs on a self-hosted instance of Bastion. 
It is kept updated to the latest releases of Bastion, with minor changes in configuration.</p>
<h5 id="responsibilities">Responsibilities</h5>
<p>The main BalaclavaBot is currently used for a few specific responsibilities as follows:</p>
<ul>
<li>Automatically assign users a role as they join the server</li><li>Usage of a level-up system for users in chat</li><li>Automatic responses triggered by certain phrases</li><li>Sending messages to the announcement channel</li></ul>
<p>It should be noted that other capabilities are currently disabled, such as music, as these will be handled by &#39;BalaclavaBeta&#39;, which runs on the Red bot. </p>
<h5 id="operation">Operation</h5>
<p>The bot and its configuration files are stored in <code>~/Bastion</code>
From there, <code>bastion.sh</code> can be used to run, stop, update, and view the status of the bot.</p>
<p>Available options:</p>
<p><code>--start</code> will run the bot. It will create a screen called <code>BastionBot</code> that can be connected to, in order to view the bot&#39;s console output. 
<code>--stop</code> will stop the bot and destroy the screen it was using
<code>--status</code> will show a simple status output that indicates whether the bot is running or has been stopped unexpectedly
<code>--update</code> will run an update for Bastion. This includes the bot itself, the dependencies contained within its folder, and node modules that the bot uses.</p>
<h5 id="configuration">Configuration</h5>
<p>Currently the bot is configured to use <code>.</code> as a prefix for commands.</p>
<p>The bot can be configured via <code>yaml</code> files located in <code>~/Bastion/settings</code></p>
<p><code>configurations.yaml</code> contains basic bot configuration, such as its prefix and commands to be automatically run at set intervals.</p>
<p><code>credentials.yaml</code> is used to set who the bot&#39;s owner is (via their Discord Client ID) as well as API keys that the bot may use for certain command functions.</p>
<h5 id="commands">Commands</h5>
<p>All commands for the bot can be found at <a href="https://bastion.traction.one/commands">https://bastion.traction.one/commands</a></p>
<hr>
<h4 id="balaclavabeta-discord-bot">BalaclavaBeta (Discord Bot)</h4>
<p>BalaclavaBeta runs on the Red discord bot (<a href="https://discord.red">https://discord.red</a>) and serves currently to fill the gaps in functionality that BalaclavaBot (running on Bastion) has.</p>
<h5 id="responsibilities">Responsibilities</h5>
<p>Primary use of this bot consist of:</p>
<ul>
<li>Music</li></ul>
<h5 id="operation">Operation</h5>
<p>From a starting point, an admin must first execute <code>source ~/redenv/bin/activate</code> to make use of Red commands. This may require switching to bash first if there is a different shell in use by default.</p>
<p>Once running in the Red environment, the bot can be started. The main installation of Red is denoted as BalaclavaRed.</p>
<p><a id="games"></a></p>
<h3 id="games">Games</h3>
<hr>
<h4 id="minecraft">Minecraft</h4>
<p>The main minecraft server is semi-vanilla, running on the <a href="https://papermc.io/">Paper</a> platform.
It uses minimal plugins for conveninece while preserving an overall Vanilla-esque experience.
<br>
To start the server: </p>
<ul>
<li>start a new terminal screen and move to <code>/media/balaclavabunker/servers/minecraftVanilla/</code></li><li>press <code>CTL+A</code> then <code>CTL+:</code> and enter <code>sessionname minecraft</code></li><li>execute <code>./start.sh</code> to startup the server. Watch the startup procedure for errors.
<br>
The server can be accessed by connecting to <code>blbz.xyz:25565</code> (default port) in-game. 
A live map of the server, powered by the Dynmap plugin, can be viewed in a browser by going to <a href="http://blbz.xyz:8123">blbz.xyz:8123</a>
A list of currently installed plugins can be viewed at <a href="https://blbz.xyz/minecraft">https://blbz.xyz/minecraft</a> with links to their development pages
An alternate list of currently used plugins is available in the vanilla server plugins folder as <code>README.md</code>
<br></li></ul>
<hr>
<p><a id="web"></a></p>
<h3 id="web">Web</h3>
<hr>
<h4 id="wordpress">WordPress</h4>
<p>WordPress is used to host the homepage at <a href="https://blbz.xyz">https://blbz.xyz</a>.
WordPress has its own database and user for storing configurations.
Its contents and all site data are located in <code>/var/www/html</code> with most of its directory names beginning in <code>wp-</code>
<br>
For maintenance, an admin can log in at <a href="https://blbz.xyz/wp-admin">https://blbz.xyz/wp-admin</a> to view the dashboard.</p>
<hr>
<h5 id="-troubleshooting"><strong>Troubleshooting</strong></h5>
<h5 id="rest-api-error-404">REST API Error 404</h5>
<p>Edit <code>/etc/apache2/apache2.conf</code> and change <code>AllowOverride None</code> to <code>AllowOverride All</code> for <code>&lt;Directory /var/www/&gt;</code></p>
<hr>
<p><a id="files"></a></p>
<h3 id="file-sharing-cloud-storage">File Sharing / Cloud Storage</h3>
<hr>
<h4 id="nextcloud">Nextcloud</h4>
<p>Nextcloud is accessible via <a href="https://blbz.xyz/nextcloud">https://blbz.xyz/nextcloud</a>
New user accounts are given 5GB of personal storage, plus access to certain external storage provided by the server (such as media shares)</p>
<p>Nextcloud itself is installed at <code>/var/www/nextcloud</code>
Nextcloud data is stored externally at <code>/media/balaclavabunker/ncdata</code>
The data directory contains user data and some configurations. It is on a separate physical disk from the install so that user data can be stored en masse without filling the root partition. </p>
<p>Some other media accessible from Nextcloud is stored in <code>/media/balaclavabox/</code> such as music, shows, and archives/backups.</p>
<hr>
<h4 id="local-shares-samba">Local Shares (Samba)</h4>
<p>Samba shares are accessible on the local network for all users, in most cases.
A music share can be accessed via <code>192.168.1.15/musicShare</code></p>
<hr>
<p><br>
<a id="updates"></a></p>
<h2 id="update-procedures">Update Procedures</h2>
<p><a id="botUpdate"></a></p>
<h3 id="balaclavabot">BalaclavaBot</h3>
<ul>
<li>Check BastionHQ announcements for any relevant information</li><li>Shutdown the bot with <code>./bastion.sh --stop</code></li><li>Run an update from Bastion&#39;s directory with <code>./bastion.sh --update</code></li><li>On completion of the update, start the bot with <code>./bastion.sh --start</code></li><li>Connect to Bastion&#39;s screen with <code>screen -r BastionBot</code> and watch for new errors that may have been caused by the update.</li><li>Send an announcement in Discord <code>#announcements</code> if there is any important information regarding the new bot version.</li></ul>
<hr>
<p><a id="minecraftUpdate"></a></p>
<h3 id="minecraft">Minecraft</h3>
<p>For the sake of brevity, <code>$minecraftVanilla</code> will be used to refer to the main server directory, which has a full path of <code>/media/balaclavabunker/servers/minecraftVanilla</code></p>
<h4 id="updating-the-game">Updating the Game</h4>
<ul>
<li>Download latest version of Paper</li><li>Move the currently used <code>paper.jar</code> to <code>$minecraftVanilla/paperBuilds</code></li><li>Send newest Paper version to <code>$minecraftVanilla/</code> and rename the jarfile to <code>paper.jar</code></li></ul>
<h4 id="updating-plugins">Updating Plugins</h4>
<ul>
<li>Grab latest plugin versions from respective links at <a href="https://blbz.xyz/minecraft">https://blbz.xyz/minecraft</a></li><li>Clean up by moving all jarfiles in <code>$minecraftVanilla/pluginsArchive</code> into <code>$minecraftVanilla/pluginsArchive/old</code></li><li>Move currently installed plugins to <code>$minecraftVanilla/pluginsArchive</code> (<code>cd</code> into <code>minecraftVanilla/plugins</code> and make use of <code>mv *.jar ../pluginsArchive</code>)</li><li>Send newly downloaded plugins to <code>$minecraftVanilla/plugins</code> and restart server.</li></ul>
<h4 id="post-update">Post Update</h4>
<ul>
<li>List relevant changes in a formatted announcement on Discord in <code>#bot-commands-admin</code></li><li>Specify in the announcement if the client must use a newer version of Minecraft to connect, or if the server is held back to a previous version</li><li>Review for errors and submit via BalaclavaBot&#39;s announcement pinning function</li><li>Edit version number on <a href="https://blbz.xyz/minecraft">blbz minecraft homepage</a> if game version is updated</li></ul>
<p><a id="nextcloudUpdate"></a></p>
<h3 id="nextcloud">Nextcloud</h3>
<p>Most of the time Nextcloud can be updated via the web-based settings page. 
If not, an update may need to be executed via <code>ocs</code> commands. Until this page is written further, it will be necessary to refer to Nextcloud documentation or instructions on the web-based settings page as to performing updates from the command line.</p>

        </article>
    </body>
</html>
